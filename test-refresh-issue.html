<!DOCTYPE html>
<html>
  <head>
    <title>Test Refresh Issue</title>
  </head>
  <body>
    <h1>Test Refresh Issue</h1>
    <div id="results"></div>
    <button onclick="testRefresh()">Test Refresh</button>

    <script>
      let refreshCount = 0;

      function testRefresh() {
        refreshCount++;
        const results = document.getElementById("results");
        results.innerHTML = `<h2>Refresh Test #${refreshCount}</h2>`;
        results.innerHTML += `<p>Time: ${new Date().toLocaleTimeString()}</p>`;
        results.innerHTML += `<p>Hostname: ${window.location.hostname}</p>`;
        results.innerHTML += `<p>Port: ${window.location.port}</p>`;

        // Test API calls
        testApiCalls();
      }

      async function testApiCalls() {
        const results = document.getElementById("results");
        const apiBaseUrl = getApiBaseUrl();

        try {
          results.innerHTML += "<h3>Testing API Calls:</h3>";
          results.innerHTML += `<p>API Base URL: ${apiBaseUrl}</p>`;

          // Test TKA schedules
          const response = await fetch(`${apiBaseUrl}/api/tka-schedules`);
          const data = await response.json();

          results.innerHTML += `<p>Status: ${response.status}</p>`;
          results.innerHTML += `<p>Success: ${data.success}</p>`;
          results.innerHTML += `<p>Data Count: ${
            data.data ? data.data.length : 0
          }</p>`;

          if (data.data && data.data.length > 0) {
            results.innerHTML += "<h4>Sample Data:</h4>";
            results.innerHTML += `<pre>${JSON.stringify(
              data.data[0],
              null,
              2
            )}</pre>`;
          }
        } catch (error) {
          results.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
        }
      }

      function getApiBaseUrl() {
        const hostname = window.location.hostname;
        if (hostname === "localhost" || hostname === "127.0.0.1") {
          return "http://127.0.0.1:8000";
        } else {
          return `http://${hostname}:8000`;
        }
      }

      // Auto test on page load
      window.onload = () => {
        testRefresh();
      };
    </script>
  </body>
</html>

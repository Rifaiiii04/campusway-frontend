<!DOCTYPE html>
<html>
  <head>
    <title>Test Export API</title>
  </head>
  <body>
    <h1>Test Export API</h1>
    <div id="results"></div>
    <button onclick="testExportApi()">Test Export API</button>

    <script>
      function getApiBaseUrl() {
        const hostname = window.location.hostname;
        if (hostname === "localhost" || hostname === "127.0.0.1") {
          return "http://127.0.0.1:8000";
        } else {
          return `http://${hostname}:8000`;
        }
      }

      async function testExportApi() {
        const results = document.getElementById("results");
        const apiBaseUrl = getApiBaseUrl();

        results.innerHTML = "<h2>Testing Export API</h2>";
        results.innerHTML += `<p>API Base URL: ${apiBaseUrl}</p>`;
        results.innerHTML += `<p>Hostname: ${window.location.hostname}</p>`;

        try {
          // Test without school_id (should fail)
          results.innerHTML += "<h3>Test 1: Without school_id</h3>";
          const response1 = await fetch(
            `${apiBaseUrl}/api/school/export-students`
          );
          results.innerHTML += `<p>Status: ${response1.status}</p>`;
          results.innerHTML += `<p>Content-Type: ${response1.headers.get(
            "content-type"
          )}</p>`;

          if (response1.status === 401) {
            results.innerHTML +=
              "<p style='color: orange;'>Expected: 401 Unauthorized (no token)</p>";
          } else {
            const data1 = await response1.text();
            results.innerHTML += `<pre>${data1}</pre>`;
          }

          // Test with school_id (should also fail without token)
          results.innerHTML += "<h3>Test 2: With school_id</h3>";
          const response2 = await fetch(
            `${apiBaseUrl}/api/school/export-students?school_id=1`
          );
          results.innerHTML += `<p>Status: ${response2.status}</p>`;
          results.innerHTML += `<p>Content-Type: ${response2.headers.get(
            "content-type"
          )}</p>`;

          if (response2.status === 401) {
            results.innerHTML +=
              "<p style='color: orange;'>Expected: 401 Unauthorized (no token)</p>";
          } else {
            const data2 = await response2.text();
            results.innerHTML += `<pre>${data2}</pre>`;
          }

          // Test with CORS headers
          results.innerHTML += "<h3>Test 3: With CORS headers</h3>";
          const response3 = await fetch(
            `${apiBaseUrl}/api/school/export-students?school_id=1`,
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
                Accept: "application/json",
              },
            }
          );
          results.innerHTML += `<p>Status: ${response3.status}</p>`;
          results.innerHTML += `<p>Content-Type: ${response3.headers.get(
            "content-type"
          )}</p>`;

          const data3 = await response3.text();
          results.innerHTML += `<pre>${data3}</pre>`;
        } catch (error) {
          results.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
        }
      }

      // Auto test on page load
      window.onload = () => {
        testExportApi();
      };
    </script>
  </body>
</html>
